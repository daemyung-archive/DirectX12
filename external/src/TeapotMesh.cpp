// This library is free software; you can redistribute it and/or
// modify it under the terms of the GNU Lesser General Public
// License as published by the Free Software Foundation; either
// version 2.1 of the License, or (at your option) any later version.


#include "generator/TeapotMesh.hpp"
#include "generator/Iterator.hpp"

#include <array>
#include <memory>

using namespace generator;



static const gml::dvec3 teapotData[32][4][4] = {
{
	{{ 1.40, 0.00, 2.40}, { 1.40,-0.78, 2.40}, { 0.78,-1.40, 2.40}, { 0.00,-1.40, 2.40}},
	{{ 1.34, 0.00, 2.53}, { 1.34,-0.75, 2.53}, { 0.75,-1.34, 2.53}, { 0.00,-1.34, 2.53}},
	{{ 1.44, 0.00, 2.53}, { 1.44,-0.81, 2.53}, { 0.81,-1.44, 2.53}, { 0.00,-1.44, 2.53}},
	{{ 1.50, 0.00, 2.40}, { 1.50,-0.84, 2.40}, { 0.84,-1.50, 2.40}, { 0.00,-1.50, 2.40}}
}, {
	{{ 0.00,-1.40, 2.40}, {-0.78,-1.40, 2.40}, {-1.40,-0.78, 2.40}, {-1.40, 0.00, 2.40}},
	{{ 0.00,-1.34, 2.53}, {-0.75,-1.34, 2.53}, {-1.34,-0.75, 2.53}, {-1.34, 0.00, 2.53}},
	{{ 0.00,-1.44, 2.53}, {-0.81,-1.44, 2.53}, {-1.44,-0.81, 2.53}, {-1.44, 0.00, 2.53}},
	{{ 0.00,-1.50, 2.40}, {-0.84,-1.50, 2.40}, {-1.50,-0.84, 2.40}, {-1.50, 0.00, 2.40}}
}, {
	{{-1.40, 0.00, 2.40}, {-1.40, 0.78, 2.40}, {-0.78, 1.40, 2.40}, { 0.00, 1.40, 2.40}},
	{{-1.34, 0.00, 2.53}, {-1.34, 0.75, 2.53}, {-0.75, 1.34, 2.53}, { 0.00, 1.34, 2.53}},
	{{-1.44, 0.00, 2.53}, {-1.44, 0.81, 2.53}, {-0.81, 1.44, 2.53}, { 0.00, 1.44, 2.53}},
	{{-1.50, 0.00, 2.40}, {-1.50, 0.84, 2.40}, {-0.84, 1.50, 2.40}, { 0.00, 1.50, 2.40}}
}, {
	{{ 0.00, 1.40, 2.40}, { 0.78, 1.40, 2.40}, { 1.40, 0.78, 2.40}, { 1.40, 0.00, 2.40}},
	{{ 0.00, 1.34, 2.53}, { 0.75, 1.34, 2.53}, { 1.34, 0.75, 2.53}, { 1.34, 0.00, 2.53}},
	{{ 0.00, 1.44, 2.53}, { 0.81, 1.44, 2.53}, { 1.44, 0.81, 2.53}, { 1.44, 0.00, 2.53}},
	{{ 0.00, 1.50, 2.40}, { 0.84, 1.50, 2.40}, { 1.50, 0.84, 2.40}, { 1.50, 0.00, 2.40}}
}, {
	{{ 1.50, 0.00, 2.40}, { 1.50,-0.84, 2.40}, { 0.84,-1.50, 2.40}, { 0.00,-1.50, 2.40}},
	{{ 1.75, 0.00, 1.88}, { 1.75,-0.98, 1.88}, { 0.98,-1.75, 1.88}, { 0.00,-1.75, 1.88}},
	{{ 2.00, 0.00, 1.35}, { 2.00,-1.12, 1.35}, { 1.12,-2.00, 1.35}, { 0.00,-2.00, 1.35}},
	{{ 2.00, 0.00, 0.90}, { 2.00,-1.12, 0.90}, { 1.12,-2.00, 0.90}, { 0.00,-2.00, 0.90}}
}, {
	{{ 0.00,-1.50, 2.40}, {-0.84,-1.50, 2.40}, {-1.50,-0.84, 2.40}, {-1.50, 0.00, 2.40}},
	{{ 0.00,-1.75, 1.88}, {-0.98,-1.75, 1.88}, {-1.75,-0.98, 1.88}, {-1.75, 0.00, 1.88}},
	{{ 0.00,-2.00, 1.35}, {-1.12,-2.00, 1.35}, {-2.00,-1.12, 1.35}, {-2.00, 0.00, 1.35}},
	{{ 0.00,-2.00, 0.90}, {-1.12,-2.00, 0.90}, {-2.00,-1.12, 0.90}, {-2.00, 0.00, 0.90}}
}, {
	{{-1.50, 0.00, 2.40}, {-1.50, 0.84, 2.40}, {-0.84, 1.50, 2.40}, { 0.00, 1.50, 2.40}},
	{{-1.75, 0.00, 1.88}, {-1.75, 0.98, 1.88}, {-0.98, 1.75, 1.88}, { 0.00, 1.75, 1.88}},
	{{-2.00, 0.00, 1.35}, {-2.00, 1.12, 1.35}, {-1.12, 2.00, 1.35}, { 0.00, 2.00, 1.35}},
	{{-2.00, 0.00, 0.90}, {-2.00, 1.12, 0.90}, {-1.12, 2.00, 0.90}, { 0.00, 2.00, 0.90}}
}, {
	{{ 0.00, 1.50, 2.40}, { 0.84, 1.50, 2.40}, { 1.50, 0.84, 2.40}, { 1.50, 0.00, 2.40}},
	{{ 0.00, 1.75, 1.88}, { 0.98, 1.75, 1.88}, { 1.75, 0.98, 1.88}, { 1.75, 0.00, 1.88}},
	{{ 0.00, 2.00, 1.35}, { 1.12, 2.00, 1.35}, { 2.00, 1.12, 1.35}, { 2.00, 0.00, 1.35}},
	{{ 0.00, 2.00, 0.90}, { 1.12, 2.00, 0.90}, { 2.00, 1.12, 0.90}, { 2.00, 0.00, 0.90}}
}, {
	{{ 2.00, 0.00, 0.90}, { 2.00,-1.12, 0.90}, { 1.12,-2.00, 0.90}, { 0.00,-2.00, 0.90}},
	{{ 2.00, 0.00, 0.45}, { 2.00,-1.12, 0.45}, { 1.12,-2.00, 0.45}, { 0.00,-2.00, 0.45}},
	{{ 1.50, 0.00, 0.23}, { 1.50,-0.84, 0.23}, { 0.84,-1.50, 0.23}, { 0.00,-1.50, 0.23}},
	{{ 1.50, 0.00, 0.15}, { 1.50,-0.84, 0.15}, { 0.84,-1.50, 0.15}, { 0.00,-1.50, 0.15}}
}, {
	{{ 0.00,-2.00, 0.90}, {-1.12,-2.00, 0.90}, {-2.00,-1.12, 0.90}, {-2.00, 0.00, 0.90}},
	{{ 0.00,-2.00, 0.45}, {-1.12,-2.00, 0.45}, {-2.00,-1.12, 0.45}, {-2.00, 0.00, 0.45}},
	{{ 0.00,-1.50, 0.23}, {-0.84,-1.50, 0.23}, {-1.50,-0.84, 0.23}, {-1.50, 0.00, 0.23}},
	{{ 0.00,-1.50, 0.15}, {-0.84,-1.50, 0.15}, {-1.50,-0.84, 0.15}, {-1.50, 0.00, 0.15}}
}, {
	{{-2.00, 0.00, 0.90}, {-2.00, 1.12, 0.90}, {-1.12, 2.00, 0.90}, { 0.00, 2.00, 0.90}},
	{{-2.00, 0.00, 0.45}, {-2.00, 1.12, 0.45}, {-1.12, 2.00, 0.45}, { 0.00, 2.00, 0.45}},
	{{-1.50, 0.00, 0.23}, {-1.50, 0.84, 0.23}, {-0.84, 1.50, 0.23}, { 0.00, 1.50, 0.23}},
	{{-1.50, 0.00, 0.15}, {-1.50, 0.84, 0.15}, {-0.84, 1.50, 0.15}, { 0.00, 1.50, 0.15}}
}, {
	{{ 0.00, 2.00, 0.90}, { 1.12, 2.00, 0.90}, { 2.00, 1.12, 0.90}, { 2.00, 0.00, 0.90}},
	{{ 0.00, 2.00, 0.45}, { 1.12, 2.00, 0.45}, { 2.00, 1.12, 0.45}, { 2.00, 0.00, 0.45}},
	{{ 0.00, 1.50, 0.23}, { 0.84, 1.50, 0.23}, { 1.50, 0.84, 0.23}, { 1.50, 0.00, 0.23}},
	{{ 0.00, 1.50, 0.15}, { 0.84, 1.50, 0.15}, { 1.50, 0.84, 0.15}, { 1.50, 0.00, 0.15}}
}, {
	{{-1.60, 0.00, 2.03}, {-1.60,-0.30, 2.03}, {-1.50,-0.30, 2.25}, {-1.50, 0.00, 2.25}},
	{{-2.30, 0.00, 2.03}, {-2.30,-0.30, 2.03}, {-2.50,-0.30, 2.25}, {-2.50, 0.00, 2.25}},
	{{-2.70, 0.00, 2.03}, {-2.70,-0.30, 2.03}, {-3.00,-0.30, 2.25}, {-3.00, 0.00, 2.25}},
	{{-2.70, 0.00, 1.80}, {-2.70,-0.30, 1.80}, {-3.00,-0.30, 1.80}, {-3.00, 0.00, 1.80}}
}, {
	{{-1.50, 0.00, 2.25}, {-1.50, 0.30, 2.25}, {-1.60, 0.30, 2.03}, {-1.60, 0.00, 2.03}},
	{{-2.50, 0.00, 2.25}, {-2.50, 0.30, 2.25}, {-2.30, 0.30, 2.03}, {-2.30, 0.00, 2.03}},
	{{-3.00, 0.00, 2.25}, {-3.00, 0.30, 2.25}, {-2.70, 0.30, 2.03}, {-2.70, 0.00, 2.03}},
	{{-3.00, 0.00, 1.80}, {-3.00, 0.30, 1.80}, {-2.70, 0.30, 1.80}, {-2.70, 0.00, 1.80}}
}, {
	{{-2.70, 0.00, 1.80}, {-2.70,-0.30, 1.80}, {-3.00,-0.30, 1.80}, {-3.00, 0.00, 1.80}},
	{{-2.70, 0.00, 1.58}, {-2.70,-0.30, 1.58}, {-3.00,-0.30, 1.35}, {-3.00, 0.00, 1.35}},
	{{-2.50, 0.00, 1.13}, {-2.50,-0.30, 1.13}, {-2.65,-0.30, 0.94}, {-2.65, 0.00, 0.94}},
	{{-2.00, 0.00, 0.90}, {-2.00,-0.30, 0.90}, {-1.90,-0.30, 0.60}, {-1.90, 0.00, 0.60}}
}, {
	{{-3.00, 0.00, 1.80}, {-3.00, 0.30, 1.80}, {-2.70, 0.30, 1.80}, {-2.70, 0.00, 1.80}},
	{{-3.00, 0.00, 1.35}, {-3.00, 0.30, 1.35}, {-2.70, 0.30, 1.58}, {-2.70, 0.00, 1.58}},
	{{-2.65, 0.00, 0.94}, {-2.65, 0.30, 0.94}, {-2.50, 0.30, 1.13}, {-2.50, 0.00, 1.13}},
	{{-1.90, 0.00, 0.60}, {-1.90, 0.30, 0.60}, {-2.00, 0.30, 0.90}, {-2.00, 0.00, 0.90}}
}, {
	{{ 1.70, 0.00, 1.43}, { 1.70,-0.66, 1.43}, { 1.70,-0.66, 0.60}, { 1.70, 0.00, 0.60}},
	{{ 2.60, 0.00, 1.43}, { 2.60,-0.66, 1.43}, { 3.10,-0.66, 0.83}, { 3.10, 0.00, 0.83}},
	{{ 2.30, 0.00, 2.10}, { 2.30,-0.25, 2.10}, { 2.40,-0.25, 2.03}, { 2.40, 0.00, 2.03}},
	{{ 2.70, 0.00, 2.40}, { 2.70,-0.25, 2.40}, { 3.30,-0.25, 2.40}, { 3.30, 0.00, 2.40}}
}, {
	{{ 1.70, 0.00, 0.60}, { 1.70, 0.66, 0.60}, { 1.70, 0.66, 1.43}, { 1.70, 0.00, 1.43}},
	{{ 3.10, 0.00, 0.83}, { 3.10, 0.66, 0.83}, { 2.60, 0.66, 1.43}, { 2.60, 0.00, 1.43}},
	{{ 2.40, 0.00, 2.03}, { 2.40, 0.25, 2.03}, { 2.30, 0.25, 2.10}, { 2.30, 0.00, 2.10}},
	{{ 3.30, 0.00, 2.40}, { 3.30, 0.25, 2.40}, { 2.70, 0.25, 2.40}, { 2.70, 0.00, 2.40}}
}, {
	{{ 2.70, 0.00, 2.40}, { 2.70,-0.25, 2.40}, { 3.30,-0.25, 2.40}, { 3.30, 0.00, 2.40}},
	{{ 2.80, 0.00, 2.48}, { 2.80,-0.25, 2.48}, { 3.53,-0.25, 2.49}, { 3.53, 0.00, 2.49}},
	{{ 2.90, 0.00, 2.48}, { 2.90,-0.15, 2.48}, { 3.45,-0.15, 2.51}, { 3.45, 0.00, 2.51}},
	{{ 2.80, 0.00, 2.40}, { 2.80,-0.15, 2.40}, { 3.20,-0.15, 2.40}, { 3.20, 0.00, 2.40}}
}, {
	{{ 3.30, 0.00, 2.40}, { 3.30, 0.25, 2.40}, { 2.70, 0.25, 2.40}, { 2.70, 0.00, 2.40}},
	{{ 3.53, 0.00, 2.49}, { 3.53, 0.25, 2.49}, { 2.80, 0.25, 2.48}, { 2.80, 0.00, 2.48}},
	{{ 3.45, 0.00, 2.51}, { 3.45, 0.15, 2.51}, { 2.90, 0.15, 2.48}, { 2.90, 0.00, 2.48}},
	{{ 3.20, 0.00, 2.40}, { 3.20, 0.15, 2.40}, { 2.80, 0.15, 2.40}, { 2.80, 0.00, 2.40}}
}, {
	{{ 0.00, 0.00, 3.15}, { 0.00, 0.00, 3.15}, { 0.00, 0.00, 3.15}, { 0.00, 0.00, 3.15}},
	{{ 0.80, 0.00, 3.15}, { 0.80,-0.45, 3.15}, { 0.45,-0.80, 3.15}, { 0.00,-0.80, 3.15}},
	{{ 0.00, 0.00, 2.85}, { 0.00, 0.00, 2.85}, { 0.00, 0.00, 2.85}, { 0.00, 0.00, 2.85}},
	{{ 0.20, 0.00, 2.70}, { 0.20,-0.11, 2.70}, { 0.11,-0.20, 2.70}, { 0.00,-0.20, 2.70}}
}, {
	{{ 0.00, 0.00, 3.15}, { 0.00, 0.00, 3.15}, { 0.00, 0.00, 3.15}, { 0.00, 0.00, 3.15}},
	{{ 0.00,-0.80, 3.15}, {-0.45,-0.80, 3.15}, {-0.80,-0.45, 3.15}, {-0.80, 0.00, 3.15}},
	{{ 0.00, 0.00, 2.85}, { 0.00, 0.00, 2.85}, { 0.00, 0.00, 2.85}, { 0.00, 0.00, 2.85}},
	{{ 0.00,-0.20, 2.70}, {-0.11,-0.20, 2.70}, {-0.20,-0.11, 2.70}, {-0.20, 0.00, 2.70}}
}, {
	{{ 0.00, 0.00, 3.15}, { 0.00, 0.00, 3.15}, { 0.00, 0.00, 3.15}, { 0.00, 0.00, 3.15}},
	{{-0.80, 0.00, 3.15}, {-0.80, 0.45, 3.15}, {-0.45, 0.80, 3.15}, { 0.00, 0.80, 3.15}},
	{{ 0.00, 0.00, 2.85}, { 0.00, 0.00, 2.85}, { 0.00, 0.00, 2.85}, { 0.00, 0.00, 2.85}},
	{{-0.20, 0.00, 2.70}, {-0.20, 0.11, 2.70}, {-0.11, 0.20, 2.70}, { 0.00, 0.20, 2.70}}
}, {
	{{ 0.00, 0.00, 3.15}, { 0.00, 0.00, 3.15}, { 0.00, 0.00, 3.15}, { 0.00, 0.00, 3.15}},
	{{ 0.00, 0.80, 3.15}, { 0.45, 0.80, 3.15}, { 0.80, 0.45, 3.15}, { 0.80, 0.00, 3.15}},
	{{ 0.00, 0.00, 2.85}, { 0.00, 0.00, 2.85}, { 0.00, 0.00, 2.85}, { 0.00, 0.00, 2.85}},
	{{ 0.00, 0.20, 2.70}, { 0.11, 0.20, 2.70}, { 0.20, 0.11, 2.70}, { 0.20, 0.00, 2.70}}
}, {
	{{ 0.20, 0.00, 2.70}, { 0.20,-0.11, 2.70}, { 0.11,-0.20, 2.70}, { 0.00,-0.20, 2.70}},
	{{ 0.40, 0.00, 2.55}, { 0.40,-0.22, 2.55}, { 0.22,-0.40, 2.55}, { 0.00,-0.40, 2.55}},
	{{ 1.30, 0.00, 2.55}, { 1.30,-0.73, 2.55}, { 0.73,-1.30, 2.55}, { 0.00,-1.30, 2.55}},
	{{ 1.30, 0.00, 2.40}, { 1.30,-0.73, 2.40}, { 0.73,-1.30, 2.40}, { 0.00,-1.30, 2.40}}
}, {
	{{ 0.00,-0.20, 2.70}, {-0.11,-0.20, 2.70}, {-0.20,-0.11, 2.70}, {-0.20, 0.00, 2.70}},
	{{ 0.00,-0.40, 2.55}, {-0.22,-0.40, 2.55}, {-0.40,-0.22, 2.55}, {-0.40, 0.00, 2.55}},
	{{ 0.00,-1.30, 2.55}, {-0.73,-1.30, 2.55}, {-1.30,-0.73, 2.55}, {-1.30, 0.00, 2.55}},
	{{ 0.00,-1.30, 2.40}, {-0.73,-1.30, 2.40}, {-1.30,-0.73, 2.40}, {-1.30, 0.00, 2.40}}
}, {
	{{-0.20, 0.00, 2.70}, {-0.20, 0.11, 2.70}, {-0.11, 0.20, 2.70}, { 0.00, 0.20, 2.70}},
	{{-0.40, 0.00, 2.55}, {-0.40, 0.22, 2.55}, {-0.22, 0.40, 2.55}, { 0.00, 0.40, 2.55}},
	{{-1.30, 0.00, 2.55}, {-1.30, 0.73, 2.55}, {-0.73, 1.30, 2.55}, { 0.00, 1.30, 2.55}},
	{{-1.30, 0.00, 2.40}, {-1.30, 0.73, 2.40}, {-0.73, 1.30, 2.40}, { 0.00, 1.30, 2.40}}
}, {
	{{ 0.00, 0.20, 2.70}, { 0.11, 0.20, 2.70}, { 0.20, 0.11, 2.70}, { 0.20, 0.00, 2.70}},
	{{ 0.00, 0.40, 2.55}, { 0.22, 0.40, 2.55}, { 0.40, 0.22, 2.55}, { 0.40, 0.00, 2.55}},
	{{ 0.00, 1.30, 2.55}, { 0.73, 1.30, 2.55}, { 1.30, 0.73, 2.55}, { 1.30, 0.00, 2.55}},
	{{ 0.00, 1.30, 2.40}, { 0.73, 1.30, 2.40}, { 1.30, 0.73, 2.40}, { 1.30, 0.00, 2.40}}
}, {
	{{ 0.00, 0.00, 0.00}, { 0.00, 0.00, 0.00}, { 0.00, 0.00, 0.00}, { 0.00, 0.00, 0.00}},
	{{ 1.43, 0.00, 0.00}, { 1.43, 0.80, 0.00}, { 0.80, 1.43, 0.00}, { 0.00, 1.43, 0.00}},
	{{ 1.50, 0.00, 0.08}, { 1.50, 0.84, 0.08}, { 0.84, 1.50, 0.08}, { 0.00, 1.50, 0.08}},
	{{ 1.50, 0.00, 0.15}, { 1.50, 0.84, 0.15}, { 0.84, 1.50, 0.15}, { 0.00, 1.50, 0.15}}
}, {
	{{ 0.00, 0.00, 0.00}, { 0.00, 0.00, 0.00}, { 0.00, 0.00, 0.00}, { 0.00, 0.00, 0.00}},
	{{ 0.00, 1.43, 0.00}, {-0.80, 1.43, 0.00}, {-1.43, 0.80, 0.00}, {-1.43, 0.00, 0.00}},
	{{ 0.00, 1.50, 0.08}, {-0.84, 1.50, 0.08}, {-1.50, 0.84, 0.08}, {-1.50, 0.00, 0.08}},
	{{ 0.00, 1.50, 0.15}, {-0.84, 1.50, 0.15}, {-1.50, 0.84, 0.15}, {-1.50, 0.00, 0.15}}
}, {
	{{ 0.00, 0.00, 0.00}, { 0.00, 0.00, 0.00}, { 0.00, 0.00, 0.00}, { 0.00, 0.00, 0.00}},
	{{-1.43, 0.00, 0.00}, {-1.43,-0.80, 0.00}, {-0.80,-1.43, 0.00}, { 0.00,-1.43, 0.00}},
	{{-1.50, 0.00, 0.08}, {-1.50,-0.84, 0.08}, {-0.84,-1.50, 0.08}, { 0.00,-1.50, 0.08}},
	{{-1.50, 0.00, 0.15}, {-1.50,-0.84, 0.15}, {-0.84,-1.50, 0.15}, { 0.00,-1.50, 0.15}}
}, {
	{{ 0.00, 0.00, 0.00}, { 0.00, 0.00, 0.00}, { 0.00, 0.00, 0.00}, { 0.00, 0.00, 0.00}},
	{{ 0.00,-1.43, 0.00}, { 0.80,-1.43, 0.00}, { 1.43,-0.80, 0.00}, { 1.43, 0.00, 0.00}},
	{{ 0.00,-1.50, 0.08}, { 0.84,-1.50, 0.08}, { 1.50,-0.84, 0.08}, { 1.50, 0.00, 0.08}},
	{{ 0.00,-1.50, 0.15}, { 0.84,-1.50, 0.15}, { 1.50,-0.84, 0.15}, { 1.50, 0.00, 0.15}}
}
};


TeapotMesh::Triangles::Triangles(const TeapotMesh& mesh) noexcept :
	mMesh{&mesh},
	mIndex{0},
	mPatchMesh{std::make_shared<BezierMesh<4, 4>>(teapotData[0], gml::ivec2{mesh.mSegments, mesh.mSegments})},
	mTriangles{mPatchMesh->triangles()}
{ }


bool TeapotMesh::Triangles::done() const noexcept
{
	return mIndex == 32;
}


Triangle TeapotMesh::Triangles::generate() const
{
	if (done()) throw std::out_of_range("Done!");

	Triangle triangle = mTriangles.generate();

	const int base = mIndex * mMesh->mPatchVertexCount;

	triangle.vertices[0] += base;
	triangle.vertices[1] += base;
	triangle.vertices[2] += base;

	return triangle;
}


void TeapotMesh::Triangles::next()
{
	if (done()) throw std::out_of_range("Done!");

	mTriangles.next();

	if (mTriangles.done()) {
		++mIndex;

		if (!done()) {
			mPatchMesh = std::make_shared<BezierMesh<4, 4>>(
				teapotData[mIndex], gml::ivec2{mMesh->mSegments, mMesh->mSegments}
			);

			mTriangles = mPatchMesh->triangles();
		}
	}
}


TeapotMesh::Vertices::Vertices(const TeapotMesh& mesh) noexcept :
	mMesh{&mesh},
	mIndex{0},
	mPatchMesh{std::make_shared<BezierMesh<4, 4>>(teapotData[0], gml::ivec2{mesh.mSegments, mesh.mSegments})},
	mVertices{mPatchMesh->vertices()}
{

}


bool TeapotMesh::Vertices::done() const noexcept
{
	return mIndex == 32;
}


MeshVertex TeapotMesh::Vertices::generate() const
{
	return mVertices.generate();
}


void TeapotMesh::Vertices::next()
{
	mVertices.next();

	if (mVertices.done()) {
		++mIndex;

		if (!done()) {
			mPatchMesh = std::make_shared<BezierMesh<4, 4>>(
				teapotData[mIndex], gml::ivec2{mMesh->mSegments, mMesh->mSegments}
			);

			mVertices = mPatchMesh->vertices();
		}
	}
}


TeapotMesh::TeapotMesh(int segments) noexcept :
	mSegments{segments},
	mPatchVertexCount{count(BezierMesh<4, 4>{teapotData[0], {segments, segments}}.vertices())}
{

}


TeapotMesh::Triangles TeapotMesh::triangles() const noexcept
{
	return Triangles{*this};
}


TeapotMesh::Vertices TeapotMesh::vertices() const noexcept
{
	return Vertices{*this};
}

